<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Fußballmanager - Startseite</title>
  <style>
    /* (Style unverändert wie bisher) */
  </style>
</head>
<body>
  <button id="themeToggle">Theme wechseln</button>
  <div class="container">
    <h1>Online-Fußballmanager Beta</h1>

    <form id="loginForm">
      <label for="loginUsername">Benutzername</label>
      <input type="text" id="loginUsername" required>
      <label for="loginPassword">Passwort</label>
      <input type="password" id="loginPassword" required>
      <button type="submit">Einloggen</button>
      <p id="loginMessage" class="message"></p>
    </form>

    <form id="registerForm">
      <label for="registerUsername">Neuer Benutzername</label>
      <input type="text" id="registerUsername" required>
      <label for="registerPassword">Passwort</label>
      <input type="password" id="registerPassword" required>
      <button type="submit">Registrieren</button>
      <p id="registerMessage" class="message"></p>
    </form>

    <form id="vereinForm" style="display:none">
      <label for="vereinStadt">Stadt oder Landkreis</label>
      <input type="text" id="vereinStadt" name="vereinStadt" required />

      <label for="vereinName">Vereinsname</label>
      <input type="text" id="vereinName" name="vereinName" required />
      <label for="vereinLogo">Logo hochladen (PNG/JPG, max. 1MB)</label>
      <input type="file" id="vereinLogo" name="vereinLogo" accept="image/png, image/jpeg" />
      <img id="logoPreview" src="" alt="Logo-Vorschau" />
      <label style="margin-top:20px;">Oder wähle ein Standardlogo:</label>
      <div id="defaultLogos" style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px;">
        <img src="logos/logo1.png" class="default-logo" />
        <img src="logos/logo2.png" class="default-logo" />
        <img src="logos/logo3.png" class="default-logo" />
        <img src="logos/logo4.png" class="default-logo" />
        <img src="logos/logo5.png" class="default-logo" />
        <img src="logos/logo6.png" class="default-logo" />
        <img src="logos/logo7.png" class="default-logo" />
        <img src="logos/logo8.png" class="default-logo" />
        <img src="logos/logo9.png" class="default-logo" />
        <img src="logos/logo10.png" class="default-logo" />
      </div>
      <button type="submit">Verein erstellen</button>
      <p id="vereinMessage" class="message"></p>
    </form>

    <section>
      <h2>Grundfunktionen der Beta-Version</h2>
      <ul>
        <li>Start mit einer Mannschaft (18 Spieler)</li>
        <li>Sportplatz mit 500 Plätzen</li>
        <li>Transfermarkt mit Funktionen: Kaufen, Verkaufen, Beobachten, Verleihen</li>
        <li>Sponsorenverwaltung</li>
        <li>Finanzübersicht (Einnahmen, Ausgaben, Kontostand)</li>
        <li>Ausbaubare Infrastruktur (mit virtuellem Geld freischaltbar)</li>
        <li>Nachwuchsleistungszentrum für Jungen und Mädchen (freischaltbar)</li>
        <li>Frauenmannschaft (freischaltbar)</li>
        <li>Start in der 10. Liga (regional), Aufstieg bis nationale Ligaebene</li>
        <li>Ligapreisgelder bei Saisonabschluss</li>
        <li>Nachwuchsligen für Spieler/innen (max. 19 Jahre alt)</li>
        <li>Regionale Pokalturniere in Saison 1</li>
        <li>Zusätzlich nationaler Pokal ab Saison 2</li>
      </ul>
    </section>

    <section>
      <h2>Technische Hinweise</h2>
      <ul>
        <li>Beta-Version dient als Testumgebung für neue Funktionen</li>
        <li>Fokus auf Funktionalität, nicht Design</li>
        <li>Kostenlose Umsetzung angestrebt (Open Source / Free Hosting Services)</li>
      </ul>
    </section>
  </div>

  <script>
    let currentUser = null;

    const loginForm = document.getElementById('loginForm');
    const registerForm = document.getElementById('registerForm');
    const vereinForm = document.getElementById('vereinForm');

    // Login prüfen beim Laden
    document.addEventListener('DOMContentLoaded', () => {
      const currentUser = localStorage.getItem('loggedInUser');
      const userData = currentUser ? JSON.parse(localStorage.getItem('user_' + currentUser)) : null;
      if (currentUser && userData && userData.verein) {
        window.location.href = 'menue.html';
      } else {
        localStorage.removeItem('loggedInUser');
      }
      const defaultLogos = document.querySelectorAll('.default-logo');
      const vereinLogoInput = document.getElementById('vereinLogo');
      const logoPreview = document.getElementById('logoPreview');
      let selectedDefaultLogo = null;

      defaultLogos.forEach(img => {
        img.addEventListener('click', () => {
          defaultLogos.forEach(i => i.classList.remove('selected'));
          img.classList.add('selected');
          selectedDefaultLogo = img.src;
          vereinLogoInput.value = '';
          logoPreview.src = img.src;
          logoPreview.style.display = 'block';
        });
      });

      const savedUser = localStorage.getItem('loggedInUser');
      if (savedUser) {
        const userData = JSON.parse(localStorage.getItem('user_' + savedUser));
        if (userData && userData.verein) {
          window.location.href = 'menue.html';
        } else {
          vereinForm.style.display = 'block';
        }
      }

      const themeToggleBtn = document.getElementById('themeToggle');
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme === 'light') {
        document.body.classList.add('light-theme');
      }
      themeToggleBtn.addEventListener('click', () => {
        document.body.classList.toggle('light-theme');
        const isLight = document.body.classList.contains('light-theme');
        localStorage.setItem('theme', isLight ? 'light' : 'dark');
      });
    });

    loginForm.addEventListener('submit', function(e) {
      e.preventDefault();
      const username = document.getElementById('loginUsername').value.trim();
      const password = document.getElementById('loginPassword').value.trim();
      const user = JSON.parse(localStorage.getItem('user_' + username));

      if (user && user.password === password) {
        currentUser = username;
        localStorage.setItem('loggedInUser', username);
        document.getElementById('loginMessage').textContent = 'Login erfolgreich';
        if (user.verein) {
          window.location.href = 'menue.html';
        } else {
          vereinForm.style.display = 'block';
        }
      } else {
        document.getElementById('loginMessage').textContent = 'Login fehlgeschlagen';
      }
    });

    registerForm.addEventListener('submit', function(e) {
      e.preventDefault();
      const username = document.getElementById('registerUsername').value.trim();
      const password = document.getElementById('registerPassword').value.trim();

      if (localStorage.getItem('user_' + username)) {
        document.getElementById('registerMessage').textContent = 'Benutzer existiert bereits';
      } else {
        const userData = { password: password, verein: null, logoBase64: null };
        localStorage.setItem('user_' + username, JSON.stringify(userData));
        document.getElementById('registerMessage').textContent = 'Registrierung erfolgreich';
      }
    });

    vereinForm.addEventListener('submit', function(e) {
      e.preventDefault();
      const vereinMessage = document.getElementById('vereinMessage');
      const vereinStadt = document.getElementById('vereinStadt').value.trim();
      const vereinName = document.getElementById('vereinName').value.trim();
      const logoFile = document.getElementById('vereinLogo').files[0];
      const username = localStorage.getItem('loggedInUser');
      const userData = JSON.parse(localStorage.getItem('user_' + username));

      if (!vereinStadt || !vereinName) {
        vereinMessage.textContent = 'Bitte einen Vereinsnamen eingeben.';
        vereinMessage.className = 'message error';
        return;
      }

      if (logoFile) {
        const reader = new FileReader();
        reader.onload = function(event) {
          userData.logoBase64 = event.target.result;
          saveVerein(userData, vereinName, username);
        };
        reader.readAsDataURL(logoFile);
      } else if (selectedDefaultLogo) {
        fetch(selectedDefaultLogo)
          .then(res => res.blob())
          .then(blob => {
            const reader = new FileReader();
            reader.onloadend = () => {
              userData.logoBase64 = reader.result;
              saveVerein(userData, vereinName, username);
            };
            reader.readAsDataURL(blob);
          });
      } else {
        userData.logoBase64 = null;
        saveVerein(userData, vereinName, username);
      }
    });

    function saveVerein(userData, vereinName, username) {
      userData.stadt = vereinStadt;
      userData.verein = vereinName;
      localStorage.setItem('user_' + username, JSON.stringify(userData));
      const vereinMessage = document.getElementById('vereinMessage');
      vereinMessage.textContent = 'Verein erfolgreich erstellt! Du wirst weitergeleitet...';
      vereinMessage.className = 'message success';
      setTimeout(() => window.location.href = 'menue.html', 1500);
    }
  </script>
</body>
</html>
